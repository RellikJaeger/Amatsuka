angular.module("myApp",["ngRoute","ngAnimate","ngSanitize","infinite-scroll","wu.masonry","toaster","ngTagsInput","myApp.controllers","myApp.filters","myApp.services","myApp.factories","myApp.directives"]).value("THROTTLE_MILLISECONDS",300).config(["$routeProvider","$locationProvider",function(t,e){return t.when("/",{templateUrl:"partials/index",controller:"IndexCtrl"}).when("/member",{templateUrl:"partials/member",controller:"MemberCtrl"}).when("/list",{templateUrl:"partials/list",controller:"ListCtrl"}).when("/find",{templateUrl:"partials/find",controller:"FindCtrl"}).when("/extract/:id?",{templateUrl:"partials/extract",controller:"ExtractCtrl"}).when("/fav",{templateUrl:"partials/fav",controller:"FavCtrl"}).when("/config",{templateUrl:"partials/config",controller:"ConfigCtrl"}).when("/help",{templateUrl:"partials/help",controller:"HelpCtrl"}).when("/logout",{redirectTo:"/"}).when("http://127.0.0.1:4040/auth/twitter/callback",{redirectTo:"/"}),e.html5Mode(!0)}]);var i,methods,_fn;methods=["log","warn","error","info","debug","dir"],_fn=function(t){window[t]=console[t]?console[t].bind(console):log};for(i in methods)_fn(methods[i]);angular.module("myApp.controllers",[]).controller("CommonCtrl",["$location","$log","$rootScope","$scope",function(t,e,r){return r.$on("$locationChangeStart",function(t,r){e.info("location changin to: "+r)})}]),angular.module("myApp.directives",[]).directive("dotLoader",function(){return{restrict:"E",template:'<div class="wrapper">\n  <div class="dot"></div>\n  <div class="dot"></div>\n  <div class="dot"></div>\n</div>'}}).directive("imgPreload",function(){return{restrict:"A",link:function(t,e){e.on("load",function(){e.addClass("in")}).on("error",function(){})}}}).directive("scrollOnClick",function(){return{restrict:"A",scope:{scrollTo:"@"},link:function(t,e){return e.on("click",function(){return $("html, body").animate({scrollTop:$(t.scrollTo).offset().top},"slow")})}}}).directive("resize",["$timeout","$rootScope","$window",function(t,e,r){return{link:function(){var n;return n=!1,angular.element(r).on("load resize",function(){n&&t.cancel(n),n=t(function(){var t,r,n;return r=angular.element(document).find("html"),t=r[0].clientWidth,n=700>t?"list":"grid",e.$broadcast("resize::resize",{layoutType:n})},200)})}}}]).directive("zoomImage",["$compile","$rootScope","TweetService",function(){return{restrict:"A",link:function(t,e,r){return e.on("click",function(){var t,e,n,i,s,a;return e=angular.element(document).find("html"),n=angular.element(document).find(".image-layer"),t='<div class="image-layer__container">\n  <img class="image-layer__img"/>\n  <div class="image-layer__loading">\n    <img src="./images/loaders/tail-spin.svg" />\n  </div>\n</div>',n.html(t),n.addClass("image-layer__overlay"),s=angular.element(document).find(".image-layer__img"),a=angular.element(document).find(".image-layer__loading"),s.hide(),s.attr("src",(""+r.imgSrc).replace(":small",":orig")).load(function(){var t,r,n,i,o,u,c;return a.remove(),o=s[0].naturalHeight,c=s[0].naturalWidth,u=o/c*100,t=e[0].clientHeight,n=e[0].clientWidth,r=t/n*100,i=u-r>=0?"h":"w",s.addClass("image-layer__img-"+i+"-wide"),s.fadeIn(1)}),i=angular.element(document).find(".image-layer__container"),i.on("click",function(){return n.html(""),n.removeClass("image-layer__overlay")})})}}}]).directive("downloadFromUrl",["$q","toaster","DownloadService",function(t,e,r){return{restrict:"A",link:function(n,i,s){return i.on("click",function(){var n,i;return i=-1===s.url.indexOf("[")?[s.url]:JSON.parse(s.url),n=[],e.pop("wait","Now Downloading ...","",0,"trustedHtml"),i.forEach(function(t,e){return n.push(r.exec(t,s.filename,e))}),t.all(n).then(function(){return e.clear(),e.pop("success","Finished Download","",2e3,"trustedHtml")})})}}}]).directive("icNavAutoclose",function(){return function(t,e){var r,n;r=$(e).find(".navbar-collapse"),n=!1,r.on("show.bs.collapse",function(){n=!0}),r.on("hide.bs.collapse",function(){n=!1}),$(e).find("a").each(function(t,e){$(e).click(function(t){-1===t.target.className.indexOf("dropdown-toggle")&&n&&"auto"===r.css("overflow-y")&&r.collapse("hide")})})}}).directive("clearLocalStorage",["toaster",function(t){return{restrict:"A",link:function(e,r){return r.on("click",function(){return t.pop("wait","Now Clearing ...","",0,"trustedHtml"),window.localStorage.clear(),t.clear(),t.pop("success","Finished clearing the list data","",2e3,"trustedHtml")})}}}]);var __hasProp={}.hasOwnProperty,__extends=function(t,e){function r(){this.constructor=t}for(var n in e)__hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},__bind=function(t,e){return function(){return t.apply(e,arguments)}};angular.module("myApp.factories",[]).factory("Tweets",["$http","$q","ToasterService","TweetService","ListService",function(t,e,r,n,i){var s;return s=function(){function t(t,e,r,n){null==e&&(e=void 0),this.checkError=__bind(this.checkError,this),this.assignTweet=__bind(this.assignTweet,this),this.normalizeTweet=__bind(this.normalizeTweet,this),this.busy=!1,this.isLast=!1,this.method=null,this.count=20,this.items=t,this.maxId=e,this.type=r,this.twitterIdStr=n||null}return t.prototype.normalizeTweet=function(t){return new Promise(function(e){return function(r,s){var a;return null!=t.error&&s(t.error),_.isEmpty(t.data)&&s({statusCode:10100}),e.maxId=n.decStrNum(_.last(t.data).id_str),a=n.normalizeTweets(t.data,i.amatsukaList.member),r(a)}}(this))},t.prototype.assignTweet=function(t){return new Promise(function(r){return function(n,i){_.isEmpty(t)&&i({statusCode:100110}),function(){e.all(t.map(function(t){return[r.items][0].push(t)})).then(function(){return r.busy=!1})}()}}(this))},t.prototype.checkError=function(t){switch(t){case 429:r.warning({title:"ツイート取得API制限",text:"15分お待ちください"});break;case 10100:this.isLast=!0,this.busy=!1,r.success({title:"全ツイート取得完了",text:"全て読み込みました"});break;case 10110:this.busy=!1}},t.prototype.nextPage=function(){return this.busy||this.isLast?void 0:(this.method="user_timeline"===this.type?n.getUserTimeline({twitterIdStr:this.twitterIdStr,maxId:this.maxId,count:this.count}):"fav"===this.type?n.getFavLists({twitterIdStr:this.twitterIdStr,maxId:this.maxId,count:this.count}):n.getListsStatuses({listIdStr:i.amatsukaList.data.id_str,maxId:this.maxId,count:this.count}),this.busy=!0,function(t){return function(){t.method.then(function(e){return t.normalizeTweet(e)}).then(function(e){return t.assignTweet(e)})["catch"](function(e){return t.checkError(e.statusCode)})}}(this)())},t}()}]).factory("Pict",["$q","toaster","TweetService",function(t,e,r){var n;return n=function(){function t(){this.busy=!1,this.isLast=!1,this.limit=10,this.skip=0,this.items=[],this.numIllustorator=0,this.numMaxSkip=0,this.doneSkip=[]}return t.prototype.randomAccess=function(){for(var t;;)if(t=_.sample(_.range(this.numMaxSkip)),!this.doneSkip.includes(t)||this.doneSkip.length>=this.numMaxSkip)break;this.doneSkip.push(t),this.skip=t*this.limit,r.getPict({skip:this.skip,limit:this.limit}).then(function(t){return function(e){return t.items=t.items.concat(e),t.skip+=t.limit,t.doneSkip.length>=t.numMaxSkip&&(t.isLast=!0),t.busy=!1}}(this))},t.prototype.load=function(){return this.busy||this.isLast?void 0:(this.busy=!0,0!==this.numIllustorator?void this.randomAccess():r.getPictCount().then(function(t){return function(e){return t.numIllustorator=e,t.numMaxSkip=(t.numIllustorator-1)/t.limit,t.randomAccess()}}(this)))},t}()}]).factory("Member",["$q","toaster","TweetService","ListService",function(t,e,r,n){var i;return i=function(){function e(t,e){this.name=t,this.idStr=e,this.isLast=!1,this.count=20,this.nextCursor=-1,this.members=[],this.memberIdx=0,this.amatsukaListIdStr=n.amatsukaList.data.id_str}return e.prototype.loadMember=function(){return r.getFollowingList({twitterIdStr:this.idStr,nextCursor:this.nextCursor,count:200}).then(function(t){return function(e){return _.isEmpty(e.data.users)||(t.members=t.members.concat(n.normalizeMembersForCopy(e.data.users)),t.nextCursor=e.data.next_cursor_str,0===e.data.next_cursor)?void 0:t.loadMember()}}(this))},e.prototype.copyMember2AmatsukaList=function(){return t(function(t){return function(e,n){var i;return 0===t.members.length?n("member is nothing"):(i="",_.each(t.members,function(t){return i+=""+t.id_str+","}),r.createAllListsMembers({listIdStr:t.amatsukaListIdStr,twitterIdStr:i}).then(function(t){return e(t)})["catch"](function(t){return n(t)}))}}(this))},e}()}]).factory("List",["$q","toaster","TweetService","ListService","Member",function(t,e,r,n,i){var s;return s=function(t){function e(t,r){e.__super__.constructor.call(this,t,r)}return __extends(e,t),e.prototype.loadMember=function(){return r.getListsMembers({listIdStr:this.idStr,count:1e3}).then(function(t){return function(e){return t.members=n.normalizeMembersForCopy(e.data.users)}}(this))},e}(i)}]).factory("AmatsukaList",["TweetService","ListService",function(t,e){var r;return r=function(){function t(t){this.name=t,this.isLast=!1,this.count=20,this.members=[],this.memberIdx=0,this.idStr=(JSON.parse(localStorage.getItem("amatsukaList"))||{}).id_str,this.amatsukaMemberList=e.normalizeMembers(JSON.parse(localStorage.getItem("amatsukaFollowList")))||[],this.amatsukaMemberLength=this.amatsukaMemberList.length}return t.prototype.updateAmatsukaList=function(){return e.update().then(function(t){return function(r){return t.idstr=e.amatsukaList.data.id_str,t.amatsukaMemberList=e.normalizeMembers(r),t.amatsukaMemberLength=t.amatsukaMemberList.length,t.length=t.amatsukaMemberLength,t.isLast=!0,void(t.members=t.amatsukaMemberList)}}(this))},t.prototype.loadMoreMember=function(){this.isLast||(this.members=this.members.concat(this.amatsukaMemberList.slice(this.memberIdx,this.memberIdx+this.count)),this.memberIdx+=this.count,this.memberIdx>this.amatsukaMemberLength&&(this.isLast=!0))},t}()}]),angular.module("myApp.filters",[]).filter("interpolate",["version",function(t){return function(e){return String(e).replace(/\%VERSION\%/g,t)}}]).filter("noHTML",function(){return function(t){return null!=t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/,"&amp;"):void 0}}).filter("newlines",["$sce",function(t){return function(e){return t.trustAsHtml(null!=e?e.replace(/\n/g,"<br />"):"")}}]).filter("trusted",["$sce",function(t){return function(e){return t.trustAsResourceUrl(e)}}]),angular.module("myApp.services",[]).service("CommonService",function(){return{isLoaded:!1}}).service("ToasterService",["toaster",function(t){return{success:function(e){return t.pop("success",e.title,e.text,2e3,"trustedHtml")},warning:function(e){return t.pop("warning",e.title,e.text,2e3,"trustedHtml")}}}]).service("DownloadService",["$http","ConvertService",function(t,e){return{exec:function(r,n,i){return t.post("/api/download",{url:r}).success(function(t){return function(s){var a,o;return a=e.base64toBlob(s.base64Data),o=/media\/.*\.(png|jpg|jpeg):orig/.exec(r)[1],n=""+n+"_"+i+"."+o,t.saveAs(a,n)}}(this))},saveAs:function(t,e){var r;return navigator.appVersion.toString().indexOf(".NET")>0?window.navigator.msSaveBlob(t,e):(r=document.createElement("a"),document.body.appendChild(r),r.style="display: none",r.href=window.URL.createObjectURL(t),r.download=e,r.click())}}}]).service("ConvertService",function(){return{base64toBlob:function(t){var e,r,n,i,s,a;for(i=void 0,a=t.split(","),n=atob(a[1]),s=a[0].split(":")[1].split(";")[0],e=new Uint8Array(n.length),i=0;i<n.length;)e[i]=n.charCodeAt(i),i++;return r=new Blob([e],{type:s})}}}),angular.module("myApp.controllers").controller("AdminUserCtrl",["$scope","$rootScope","$location","$log","AuthService",function(t,e,r,n,i){return t.isLoaded=!1,t.isAuthenticated=i.status.isAuthenticated,i.status.isAuthenticated?void(t.isLoaded=!0):i.isAuthenticated().success(function(e){return _.isNull(e.data)?(t.isLoaded=!0,void r.path("/")):(i.status.isAuthenticated=!0,t.isAuthenticated=i.status.isAuthenticated,i.user=e.data,t.user=e.data,t.isLoaded=!0)}).error(function(){return void 0})}]),angular.module("myApp.controllers").controller("AuthCtrl",["$scope","$location","AuthService",function(t,e,r){return _.isEmpty(r.user)?e.path("/"):void 0}]),angular.module("myApp.controllers").controller("ConfigCtrl",["$scope","$location","AuthService","ConfigService",function(t,e,r,n){return _.isEmpty(r.user)&&e.path("/"),n.getFromDB().then(function(t){return n.set(t)})["catch"](function(){return n.init()})["finally"](function(){return void(t.config=n.config)}),t.$watch("config",function(t,e){JSON.stringify(t)!==JSON.stringify(e)&&_.isNumber(t.favlowerLimit)&&(n.update(),n.save2DB().then(function(){return void 0})["catch"](function(){return void 0}))},!0)}]),angular.module("myApp.controllers").controller("ExtractCtrl",["$scope","$routeParams","$location","Tweets","AuthService","TweetService","ListService",function(t,e,r,n,i,s,a){var o;return _.isEmpty(i.user)&&r.path("/"),a.amatsukaList={data:JSON.parse(localStorage.getItem("amatsukaList"))||{},member:JSON.parse(localStorage.getItem("amatsukaFollowList"))||[]},a.hasListData()||r.path("/"),t.listIdStr=a.amatsukaList.data.id_str,t.filter={screenName:"",keyword:"",isIncludeRetweet:!1},t.extract={},t.extract.tweets=[],void 0===e.id||(o=e.id.indexOf(!1)?{screenName:e.id}:{twitterIdStr:e.id},t.isLoading=!0,s.showUsers(o).then(function(e){return t.extract.user=a.normalizeMember(e.data)}).then(function(e){return s.getAllPict({twitterIdStr:e.id_str,isIncludeRetweet:t.filter.isIncludeRetweet})}).then(function(e){return _.chain(e).filter(function(e){return~e.text.indexOf(t.filter.keyword)}).value()}).then(function(e){var r;return r=s.normalizeTweets(e,a.amatsukaList.member),t.extract.tweets=r.sort(function(t,e){return e.totalNum-t.totalNum}),t.isLoading=!1})),t.execFilteringPictWithKeyword=function(){return t.isLoading=!0,s.showUsers({screenName:t.filter.screenName}).then(function(e){return t.extract.user=a.normalizeMember(e.data)}).then(function(e){return s.getAllPict({twitterIdStr:e.id_str,isIncludeRetweet:t.filter.isIncludeRetweet})}).then(function(e){return _.chain(e).filter(function(e){return~e.text.indexOf(t.filter.keyword)}).value()}).then(function(e){var r;return r=s.normalizeTweets(e,a.amatsukaList.member),t.extract.tweets=r.sort(function(t,e){return e.totalNum-t.totalNum}),t.isLoading=!1})},t.$on("addMember",function(e,r){s.applyFollowStatusChange(t.extract.tweets,r)}),t.$on("resize::resize",function(e,r){t.$apply(function(){t.layoutType=r.layoutType})})}]),angular.module("myApp.controllers").controller("FavCtrl",["$scope","$location","AuthService","TweetService","ListService","Tweets",function(t,e,r,n,i,s){return _.isEmpty(r.user)&&e.path("/"),t.isLoaded=!1,t.layoutType="grid",i.amatsukaList={data:JSON.parse(localStorage.getItem("amatsukaList"))||{},member:JSON.parse(localStorage.getItem("amatsukaFollowList"))||[]},i.hasListData()||e.path("/"),t.tweets=new s([],void 0,"fav",r.user._json.id_str),t.listIdStr=i.amatsukaList.data.id_str,t.isLoaded=!0,t.$on("addMember",function(e,r){n.applyFollowStatusChange(t.tweets.items,r)}),t.$on("resize::resize",function(e,r){t.$apply(function(){t.layoutType=r.layoutType})})}]),angular.module("myApp.controllers").controller("FindCtrl",["$scope","$location","AuthService","ListService","Pict",function(t,e,r,n,i){return _.isEmpty(r.user)&&e.path("/"),n.amatsukaList={data:JSON.parse(localStorage.getItem("amatsukaList"))||{},member:JSON.parse(localStorage.getItem("amatsukaFollowList"))||[]},n.hasListData()||e.path("/"),t.pictList=new i}]),angular.module("myApp.controllers").controller("HelpCtrl",["$scope","$location","AuthService",function(t,e,r){return _.isEmpty(r.user)?e.path("/"):void 0}]),angular.module("myApp.controllers").controller("IndexCtrl",["$scope","$location","AuthService","TweetService","ListService","ConfigService","Tweets",function(t,e,r,n,i,s,a){var o,u;if(!_.isEmpty(r.user))return t.listIdStr="",t.isLoaded=!1,t.layoutType="grid",t.message="リストデータの確認中",u=localStorage.getItem("amatsukaList"),u="undefined"===u?{}:JSON.parse(u),o=localStorage.getItem("amatsukaFollowList"),o="undefined"===o?[]:JSON.parse(o),_.isEmpty(u)&&window.localStorage.clear(),i.amatsukaList={data:u,member:o},i.isSameUser().then(function(e){return e?(t.tweets=new a([]),void function(){i.update().then(function(){return void 0})}()):(t.message="リストデータの更新中",i.update().then(function(){t.tweets=new a([])})["catch"](function(){return t.message="リストを作成中",i.init().then(function(){return s.init(),s.save2DB()}).then(function(){return t.tweets=new a([])})})["finally"](function(){return t.message=""}))}).then(function(){return void 0})["finally"](function(){t.listIdStr=i.amatsukaList.data.id_str,t.isLoaded=!0,t.message=""}),t.$on("addMember",function(e,r){n.applyFollowStatusChange(t.tweets.items,r)}),t.$on("resize::resize",function(e,r){t.$apply(function(){t.layoutType=r.layoutType})})}]),angular.module("myApp.controllers").controller("ListCtrl",["$scope","$location","AuthService","TweetService","ListService","List","Member","AmatsukaList",function(t,e,r,n,i,s,a,o){return _.isEmpty(r.user)&&e.path("/"),i.amatsukaList={data:JSON.parse(localStorage.getItem("amatsukaList"))||{},member:JSON.parse(localStorage.getItem("amatsukaFollowList"))||[]},i.hasListData()||e.path("/"),t.amatsukaList=new o("Amatsuka"),n.getListsList(r.user._json.id_str).then(function(e){var n,i;return n=_.reject(e.data,function(t){return t.full_name==="@"+r.user.username+"/amatsuka"}),t.ownList=n||[],i={name:"friends",full_name:"friends",id_str:r.user.id_str,uri:"/following"},t.ownList.push(i)})["catch"](function(){return void 0}),t.$watch("sourceListData",function(e){return null!=(null!=e?e.name:void 0)?function(){t.sourceList={},t.sourceList="friends"===e.name?new a(e.name,r.user._json.id_str):new s(e.name,e.id_str),t.sourceList.loadMember()}():void 0}),t.$on("list:addMember",function(){t.amatsukaList.updateAmatsukaList()}),t.$on("list:copyMember",function(){t.amatsukaList.updateAmatsukaList(),t.sourceList.members=i.changeFollowStatusAllMembers(t.sourceList.members,!0),$(".btn-follow").each(function(){return this.innerText="フォロー解除"})}),t.$on("list:removeMember",function(){t.amatsukaList.updateAmatsukaList()})}]),angular.module("myApp.controllers").controller("MemberCtrl",["$scope","$location","AuthService","ListService","AmatsukaList",function(t,e,r,n,i){return _.isEmpty(r.user)&&e.path("/"),n.amatsukaList={data:JSON.parse(localStorage.getItem("amatsukaList"))||{},member:JSON.parse(localStorage.getItem("amatsukaFollowList"))||[]},n.hasListData()||e.path("/"),t.list=new i("Amatsuka"),t.$watch("searchWord.screen_name",function(e,r){var n,i,s,a,o;if(e!==r){if(""!==e)return t.list.members=t.list.amatsukaMemberList.filter(function(t){return-1!==t.screen_name.indexOf(e)});for(t.list.members=[],t.list.memberIdx=0,o=t.list.amatsukaMemberList,n=s=0,a=o.length;a>s;n=++s){if(i=o[n],n>20)return;t.list.members.push(i),t.list.memberIdx++}}})}]),angular.module("myApp.controllers").controller("UserCtrl",["$scope","$rootScope","$location","AuthService","TweetService","ListService","Tweets",function(t,e,r,n,i,s,a){return _.isEmpty(n.user)?void 0:(t.isOpened=!1,t.$on("userData",function(e,r){t.isOpened&&(t.user=s.normalizeMember(r),t.listIdStr=s.amatsukaList.data.id_str)}),t.$on("tweetData",function(e,r){var n,s,o;t.isOpened&&(n=i.decStrNum(_.last(r).id_str),o=i.filterIncludeImage(r),s=i.normalizeTweets(o),t.tweets=new a(s,n,"user_timeline",t.user.id_str))}),t.$on("isOpened",function(){t.isOpened=!0,t.user={},t.tweets={}}),t.$on("isClosed",function(){t.isOpened=!1,t.user=null,t.tweets=null}),t.$on("addMember",function(e,r){_.isUndefined(t.tweets)||i.applyFollowStatusChange(t.tweets.items,r)}))}]),angular.module("myApp.directives").directive("appVersion",["version",function(t){return function(e,r){r.text(t)}}]),angular.module("myApp.directives").directive("copyMember",["$rootScope","toaster","TweetService",function(t,e){return{restrict:"A",scope:{sourceList:"="},link:function(r,n){return n.on("click",function(){return n.hasClass("disabled")?void 0:window.confirm("コピーしてもよろしいですか？")?(n.addClass("disabled"),e.pop("wait","Now Copying ...","",0,"trustedHtml"),r.sourceList.copyMember2AmatsukaList().then(function(r){return n.removeClass("disabled"),e.clear(),t.$broadcast("list:copyMember",r),e.pop("success","Finished copy member","",2e3,"trustedHtml")})):void 0})}}}]),angular.module("myApp.directives").directive("favoritable",["TweetService",function(t){return{restrict:"A",scope:{favNum:"=",favorited:"=",tweetIdStr:"@"},link:function(e,r){return e.favorited&&r.addClass("favorited"),r.on("click",function(){return e.favorited?(r.removeClass("favorited"),t.destroyFav({tweetIdStr:e.tweetIdStr}).then(function(){return e.favNum-=1,e.favorited=!e.favorited})):(r.addClass("favorited"),t.createFav({tweetIdStr:e.tweetIdStr}).then(function(){return e.favNum+=1,e.favorited=!e.favorited}))})}}}]).directive("retweetable",["TweetService",function(t){return{restrict:"A",scope:{retweetNum:"=",retweeted:"=",tweetIdStr:"@"},link:function(e,r){return e.retweeted&&r.addClass("retweeted"),r.on("click",function(){return e.retweeted?(r.removeClass("retweeted"),t.destroyStatus({tweetIdStr:e.tweetIdStr}).then(function(){return e.retweetNum-=1,e.retweeted=!e.retweeted})):window.confirm("リツイートしてもよろしいですか？")?(r.addClass("retweeted"),t.retweetStatus({tweetIdStr:e.tweetIdStr}).then(function(){return e.retweetNum+=1,e.retweeted=!e.retweeted})):void 0})}}}]).directive("followable",["$rootScope","ListService","TweetService",function(t,e,r){return{restrict:"E",replace:!0,scope:{listIdStr:"@",tweet:"@",followStatus:"="},template:'<span class="label label-default timeline__post--header--label">{{content}}</span>',link:function(n,i){var s,a,o;return a=JSON.parse(n.tweet),s=r.isRT(a),o=r.get(a,"user.id_str",s),n.followStatus===!1&&(n.content="+"),i.on("mouseover",function(){return n.content="フォロー",n.$apply()}),i.on("mouseout",function(){return n.content="+",n.$apply()}),i.on("click",function(){var s;return s={listIdStr:n.listIdStr,twitterIdStr:o},n.followStatus===!1?(i.addClass("label-success"),i.fadeOut(200),r.createListsMembers(s).then(function(){return e.addMember(o),t.$broadcast("addMember",o),r.collectProfile({twitterIdStr:o})}).then(function(){return void 0})):void 0})}}}]).directive("followable",["$rootScope","ListService","TweetService",function(t,e,r){return{restrict:"A",scope:{listIdStr:"@",twitterIdStr:"@",followStatus:"="},link:function(n,i){return i[0].innerText=n.followStatus?"フォロー解除":"フォロー",i.on("click",function(){var s;return s={listIdStr:n.listIdStr,twitterIdStr:n.twitterIdStr},n.isProcessing=!0,n.followStatus===!0&&(i[0].innerText="フォロー",r.destroyListsMembers(s).then(function(r){return e.removeMember(n.twitterIdStr),t.$broadcast("list:removeMember",r),n.isProcessing=!1})),n.followStatus===!1&&(i[0].innerText="フォロー解除",r.createListsMembers(s).then(function(i){return e.addMember(n.twitterIdStr),t.$broadcast("addMember",n.twitterIdStr),t.$broadcast("list:addMember",i),n.isProcessing=!1,r.collectProfile({twitterIdStr:n.twitterIdStr})}).then(function(){return void 0})),n.followStatus=!n.followStatus})}}}]).directive("showTweet",["$rootScope","TweetService",function(t,e){return{restrict:"A",scope:{twitterIdStr:"@"},link:function(r,n){var i;return i=function(){return e.showUsers({twitterIdStr:r.twitterIdStr}).then(function(n){return t.$broadcast("userData",n.data),e.getUserTimeline({twitterIdStr:r.twitterIdStr})}).then(function(e){return t.$broadcast("tweetData",e.data)})},n.on("click",function(){var e,r,n,s,a,o;return t.$broadcast("isOpened",!0),e=angular.element(document),n=e.find(".user-sidebar"),s=e.find(".user-sidebar__header"),(a=-1!==n[0].className.indexOf(".user-sidebar-in"))?void i():(n.addClass("user-sidebar-in"),s.removeClass("user-sidebar-out"),r=e.find("body"),r.addClass("scrollbar-y-hidden"),o=e.find(".layer"),o.addClass("fullscreen-overlay"),i(),o.on("click",function(){return r.removeClass("scrollbar-y-hidden"),o.removeClass("fullscreen-overlay"),n.removeClass("user-sidebar-in"),s.addClass("user-sidebar-out"),t.$broadcast("isClosed",!0)}))})}}}]).directive("newTweetLoad",["$rootScope","TweetService",function(t,e){return{restrict:"E",scope:{listIdStr:"@"},template:'<a class="btn" ng-disabled="isProcessing">{{text}}</a>',link:function(r,n){return r.text="新着を読み込む",n.on("click",function(){var n;return r.isProcessing=!0,n={listIdStr:r.listIdStr,count:50},e.getListsStatuses(n).then(function(e){return t.$broadcast("newTweet",e.data),r.text="新着を読み込む",r.isProcessing=!1})})}}}]).directive("showStatuses",["$compile","TweetService",function(t,e){return{restrict:"A",link:function(r,n,i){return n.on("click",function(){return e.showStatuses({tweetIdStr:i.tweetIdStr}).then(function(e){var n,i,s;return i='<div class="image-layer__caption">\n  <div class="timeline__post--footer">\n    <div class="timeline__post--footer--contents">\n      <div class="timeline__post--footer--contents--controls">\n        <a href="'+e.data.entities.media[0].expanded_url+'" target="_blank">\n          <i class="fa fa-twitter icon-twitter"></i>\n        </a>\n        <i class="fa fa-retweet icon-retweet" tweet-id-str="'+e.data.id_str+'" retweeted="'+e.data.retweeted+'" retweetable="retweetable"></i>\n        <i class="fa fa-heart icon-heart" tweet-id-str="'+e.data.id_str+'" favorited="'+e.data.favorited+'" favoritable="favoritable"></i>\n        <a><i class="fa fa-download" data-url="'+e.data.extended_entities.media[0].media_url_https+':orig" filename="'+e.data.user.screen_name+"_"+e.data.id_str+'" download-from-url="download-from-url"></i></a>\n      </div>\n    </div>\n  </div>\n</div>',n=angular.element(document).find(".image-layer"),_.isEmpty(n.html())?void 0:(s=t(i)(r).hide().fadeIn(300),n.append(s))})})}}}]),angular.module("myApp.services").service("AuthService",["$http",function(t){return{isAuthenticated:function(){return t.get("/isAuthenticated")},findUserById:function(e){return t.post("/api/findUserById",e)},status:{isAuthenticated:!1},user:{}}}]),angular.module("myApp.services").service("ConfigService",["$http","$q",function(t,e){return{config:{},set:function(t){return this.config=t},get:function(){return new Promise(function(t){return function(e){return _.isEmpty(t.config)?t.getFromDB().then(function(r){return t.set(r),e(r)}):e(t.config)}}(this))},update:function(){localStorage.setItem("amatsuka.config",JSON.stringify(this.config))},init:function(){return this.config={includeRetweet:!0,ngUsername:[],ngWord:[]},localStorage.setItem("amatsuka.config",JSON.stringify(this.config))},getFromDB:function(){return e(function(e,r){return t.get("/api/config").success(function(t){return _.isNull(t.data)?r("Not found data"):e(JSON.parse(t.data.configStr))}).error(function(t){return r(t||"getFromDB Request failed")})})},save2DB:function(){return e(function(e){return function(r,n){return t.post("/api/config",{config:e.config}).success(function(t){return r(t)}).error(function(t){return n(t||"save2DB Request failed")})}}(this))}}}]),angular.module("myApp.services").service("ListService",["$http","$q","AuthService","TweetService",function(t,e,r,n){return{amatsukaList:{data:[],member:{}},registerMember2LocalStorage:function(){localStorage.setItem("amatsukaFollowList",JSON.stringify(this.amatsukaList.member))},addMember:function(t){return n.showUsers({twitterIdStr:t}).then(function(t){return function(e){return t.amatsukaList.member.push(e.data),t.registerMember2LocalStorage()}}(this))},removeMember:function(t){this.amatsukaList.member=_.reject(this.amatsukaList.member,{id_str:t}),this.registerMember2LocalStorage()},isFollow:function(t,e){var r;return null==e&&(e=!0),r=t.id_str,_.has(t,"user")&&(r=n.get(t,"user.id_str",e)),!!_.findWhere(this.amatsukaList.member,{id_str:r})},normalizeMembers:function(t){return _.each(t,function(t){t.followStatus=!0,t.description=n.activateLink(t.description),t.profile_image_url_https=n.iconBigger(t.profile_image_url_https)})},changeFollowStatusAllMembers:function(t,e){return _.map(t,function(t){return t.followStatus=e,t})},normalizeMember:function(t){var e,r;return e=n.getExpandedURLFromDescription(t.entities),r=n.getExpandedURLFromURL(t.entities),_.each(e,function(e){t.description=t.description.replace(e.url,e.expanded_url)}),_.each(r,function(e){t.url=t.url.replace(e.url,e.expanded_url)}),t.followStatus=this.isFollow(t),t.description=n.activateLink(t.description),t.profile_image_url_https=n.iconBigger(t.profile_image_url_https),t},normalizeMembersForCopy:function(t){return _.each(t,function(t){return function(e){e.followStatus=t.isFollow(e),e.isPermissionCopy=!0,e.profile_image_url_https=n.iconBigger(e.profile_image_url_https)}}(this))},update:function(){return n.getListsList({twitterIdStr:r.user._json.id_str}).then(function(t){return function(e){return t.amatsukaList.data=_.findWhere(e.data,{full_name:"@"+r.user.username+"/amatsuka"}),localStorage.setItem("amatsukaList",JSON.stringify(t.amatsukaList.data)),n.getListsMembers({listIdStr:t.amatsukaList.data.id_str})}}(this)).then(function(t){return function(e){return t.amatsukaList.member=e.data.users,localStorage.setItem("amatsukaFollowList",JSON.stringify(t.amatsukaList.member)),e.data.users}}(this))},init:function(){return n.createLists({name:"Amatsuka",mode:"private"}).then(function(t){return function(e){var r;return t.amatsukaList.data=e.data,localStorage.setItem("amatsukaList",JSON.stringify(e.data)),r={listIdStr:e.data.id_str,twitterIdStr:void 0},n.createAllListsMembers(r)}}(this)).then(function(t){return n.getListsMembers({listIdStr:t.data.id_str})}).then(function(t){return function(e){return t.amatsukaList.member=e.data.users,localStorage.setItem("amatsukaFollowList",JSON.stringify(e.data.users)),e.data.users}}(this))},isSameUser:function(){return e(function(t,e){return n.getListsList({twitterIdStr:r.user._json.id_str}).then(function(e){var n,i;return i=JSON.parse(localStorage.getItem("amatsukaList"))||{},n=_.findWhere(e.data,{full_name:"@"+r.user.username+"/amatsuka"})||{id_str:null},t(i.id_str===n.id_str)})["catch"](function(t){return e(t)})})},hasListData:function(){return!(_.isEmpty(this.amatsukaList.data)&&_.isEmpty(this.amatsukaList.member))}}}]),angular.module("myApp.services").service("TweetService",["$http","$q","$injector","ConfigService","ToasterService","toaster",function(t,e,r,n,i,s){return{activateLink:function(t){return t.replace(/((ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&amp;%@!&#45;\/]))?)/g,'<a href="$1" target="_blank">$1</a>').replace(/(^|\s)(@|＠)(\w+)/g,'$1<a href="http://www.twitter.com/$3" target="_blank">@$3</a>').replace(/(?:^|[^ーー゛゜々ヾヽぁ-ヶ一-龠ａ-ｚＡ-Ｚ０-９a-zA-Z0-9&_\/>]+)[#＃]([ー゛゜々ヾヽぁ-ヶ一-龠ａ-ｚＡ-Ｚ０-９a-zA-Z0-9_]*[ー゛゜々ヾヽぁ-ヶ一-龠ａ-ｚＡ-Ｚ０-９a-zA-Z]+[ー゛゜々ヾヽぁ-ヶ一-龠ａ-ｚＡ-Ｚ０-９a-zA-Z0-9_]*)/g,' <a href="http://twitter.com/search?q=%23$1" target="_blank">#$1</a>')},iconBigger:function(t){return _.isUndefined(t)?this.replace("normal","bigger"):t.replace("normal","bigger")},hasOrigParameter:function(){return void 0},applyFollowStatusChange:function(t,e){return _.map(t,function(t){return function(r){var n,i;return i=_.has(r,"retweeted_status"),n=t.get(r,"user.id_str",i),n===e?r.followStatus=!0:void 0}}(this))},normalizeTweets:function(t){var e;return e=r.get("ListService"),_.map(t,function(t){return function(r){var n;return n=_.has(r,"retweeted_status"),r.isRT=n,r.followStatus=e.isFollow(r,n),r.text=t.expandTweetUrl(r,n),r.time=t.fromNow(t.get(r,"tweet.created_at",!1)),r.retweetNum=t.get(r,"tweet.retweet_count",n),r.favNum=t.get(r,"tweet.favorite_count",n),r.tweetIdStr=t.get(r,"tweet.id_str",n),r.sourceUrl=t.get(r,"display_url",n),r.picUrlList=t.get(r,"media_url_https:small",n),r.picOrigUrlList=t.get(r,"media_url_https:orig",n),r.video_url=t.get(r,"video_url",n),r.fileName=t.get(r,"screen_name",n)+"_"+t.get(r,"tweet.id_str",n),r.user.profile_image_url_https=t.iconBigger(r.user.profile_image_url_https),r}}(this))},isRT:function(t){return _.has(t,"retweeted_status")},get:function(t,e,r){var n,i,s,a,o,u,c,l,d;switch(n=r?t.retweeted_status:t,e){case"description":return n.user.description;
case"display_url":return null!=(i=n.entities)&&null!=(s=i.media)?s[0].display_url:void 0;case"entities":return n.entities;case"expanded_url":return null!=(a=n.entities)&&null!=(o=a.media)?o[0].expanded_url:void 0;case"followers_count":return n.user.followers_count;case"friends_count":return n.user.friends_count;case"hashtags":return null!=(u=n.entities)?u.hashtags:void 0;case"media_url":return _.map(n.extended_entities.media,function(t){return t.media_url});case"media_url_https":return _.map(n.extended_entities.media,function(t){return t.media_url_https});case"media_url:orig":return _.map(n.extended_entities.media,function(t){return t.media_url+":orig"});case"media_url_https:orig":return _.map(n.extended_entities.media,function(t){return t.media_url_https+":orig"});case"media_url_https:small":return _.map(n.extended_entities.media,function(t){return t.media_url_https+":small"});case"video_url":return null!=(c=n.extended_entities)&&null!=(l=c.media[0])&&null!=(d=l.video_info)?d.variants[0].url:void 0;case"name":return n.user.name;case"profile_banner_url":return n.user.profile_banner_url;case"profile_image_url":return n.user.profile_image_url;case"profile_image_url_https":return n.user.profile_image_url_https;case"statuses_count":return n.user.statuses_count;case"screen_name":return n.user.screen_name;case"source":return n.source;case"text":return n.text;case"timestamp_ms":return n.timestamp_ms;case"tweet.created_at":return n.created_at;case"tweet.favorite_count":return n.favorite_count;case"tweet.retweet_count":return n.retweet_count;case"tweet.id_str":return n.id_str;case"tweet.lang":return n.lang;case"user.created_at":return n.user.created_at;case"user.id_str":return n.user.id_str;case"user.favorite_count":return n.favorite_count;case"user.retweet_count":return n.retweet_count;case"user.lang":return n.user.lang;case"user.url":return n.user.url;default:return null}},expandTweetUrl:function(t,e){var r;return t.text=this.get(t,"text",e),r=this.getExpandedURLFromTweet(t.entities),_.each(r,function(){return function(e){t.text=t.text.replace(e.url,e.expanded_url)}}(this)),t.text=this.activateLink(t.text),t.text},getExpandedURLFromTweet:function(t){return _.has(t,"urls")?t.urls:""},getExpandedURLFromURL:function(t){return _.has(t,"url")?t.url.urls:""},getExpandedURLFromDescription:function(t){return _.has(t,"description")&&_.has(t.description,"urls")?t.description.urls:""},decStrNum:function(t){var e,r;for(t=t.toString(),r=t,e=t.length-1;e>-1;){if("0"!==t[e])return r=r.substring(0,e)+(parseInt(t[e],10)-1).toString()+r.substring(e+1);r=r.substring(0,e)+"9"+r.substring(e+1),e--}return r},fromNow:function(t){return moment(t).fromNow(!0)},filterIncludeImage:function(t){return _.reject(t,function(t){return!_.has(t,"extended_entities")||_.isEmpty(t.extended_entities.media)})},collectProfile:function(r){return e(function(e,n){return t.post("/api/collect/profile",r).success(function(t){return e(t)}).error(function(t){return n(t)})})},getPict:function(r){return e(function(e,n){return t.get("/api/collect/"+r.skip+"/"+r.limit).success(function(t){return e(t)}).error(function(t){return n(t)})})},getPictCount:function(){return e(function(e,r){return t.get("/api/collect/count").success(function(t){return e(t.count)}).error(function(t){return r(t)})})},getAllPict:function(t){return e(function(e){return function(r){var n,i,a;return a=[],i=i||0,(n=function(){return e.getUserTimeline({twitterIdStr:t.twitterIdStr,maxId:i,count:200,isIncludeRetweet:t.isIncludeRetweet}).then(function(t){var e;return _.isUndefined(t.data)?(s.pop("error","API制限。15分お待ち下さい。"),r(a)):t.data.length<2?(s.pop("success","最後まで読み終えました。"),r(a)):(i=t.data[t.data.length-1].id_str,e=_.filter(t.data,function(t){var e;return e=_.has(t,"extended_entities")&&!_.isEmpty(t.extended_entities.media)}),_.each(e,function(t){t.totalNum=t.retweet_count+t.favorite_count,t.tweetIdStr=t.id_str}),a=a.concat(e),n())})})()}}(this))},checkError:function(t){switch(t){case 429:i.warning({title:"API制限",text:"15分お待ちください"})}},getListsList:function(r){return e(function(e){return function(n,i){return t.get("/api/lists/list/"+r.twitterIdStr).success(function(t){return _.has(t,"error")?(e.checkError(t.error.statusCode),i(t)):n(t)}).error(function(t){return i(t)})}}(this))},createLists:function(r){return e(function(e,n){return t.post("/api/lists/create",r).success(function(t){return e(t)}).error(function(t){return n(t)})})},getListsMembers:function(r){return e(function(e,n){return t.get("/api/lists/members/"+r.listIdStr+"/"+r.count).success(function(t){return e(t)}).error(function(t){return n(t)})})},getListsStatuses:function(r){return e(function(e,n){return t.get("/api/lists/statuses/"+r.listIdStr+"/"+r.maxId+"/"+r.count).success(function(t){return e(t)}).error(function(t){return n(t)})})},createListsMembers:function(r){return e(function(e,n){return t.post("/api/lists/members/create",r).success(function(t){return e(t)}).error(function(t){return n(t)})})},createAllListsMembers:function(r){return e(function(e,n){return t.post("/api/lists/members/create_all",r).success(function(t){return e(t)}).error(function(t){return n(t)})})},destroyListsMembers:function(r){return e(function(e){return t.post("/api/lists/members/destroy",r).success(function(t){return e(t)})})},getUserTimeline:function(r){return e(function(e){return t.get("/api/timeline/"+r.twitterIdStr+"/"+r.maxId+"/"+r.count+"?isIncludeRetweet="+r.isIncludeRetweet).success(function(t){return e(t)})})},getFollowingList:function(r){return e(function(e){return t.get("/api/friends/list/"+r.twitterIdStr+"/"+r.count).success(function(t){return e(t)})})},showStatuses:function(r){return e(function(e){return t.get("/api/statuses/show/"+r.tweetIdStr).success(function(t){return e(t)})})},showUsers:function(r){return e(function(e){return t.get("/api/users/show/"+r.twitterIdStr+"/"+r.screenName).success(function(t){return e(t)})})},getFavLists:function(r){return e(function(e){return t.get("/api/favorites/lists/"+r.twitterIdStr+"/"+r.maxId+"/"+r.count).success(function(t){return e(t)})})},createFav:function(r){return e(function(e){return t.post("/api/favorites/create",r).success(function(t){return e(t)})})},destroyFav:function(r){return e(function(e){return t.post("/api/favorites/destroy",r).success(function(t){return e(t)})})},retweetStatus:function(r){return e(function(e){return t.post("/api/statuses/retweet",r).success(function(t){return e(t)})})},destroyStatus:function(r){return e(function(e){return t.post("/api/statuses/destroy",r).success(function(t){return e(t)})})}}}]);